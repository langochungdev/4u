@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Dancing+Script:wght@400;700&family=Mountains+of+Christmas:wght@700&display=swap');

/* --- NÚT NHẠC --- */
.music-toggle-btn {
    position: absolute; top: 20px; right: 20px; z-index: 1000;
    width: 45px; height: 45px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    color: #fff; font-size: 1.5rem;
    cursor: pointer; display: flex; justify-content: center; align-items: center;
    backdrop-filter: blur(5px); transition: all 0.3s;
}
.music-toggle-btn:hover { background: rgba(255, 255, 255, 0.4); transform: scale(1.1); }
.music-toggle-btn.playing {
    border-color: #ffd700; color: #ffd700;
    animation: rotateMusic 3s linear infinite;
}
@keyframes rotateMusic { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

/* =========================================
   BACKGROUND & SCENE
   ========================================= */
.christmas-container { 
    position: relative; width: 100%; height: 100vh; overflow: hidden; 
    background: linear-gradient(to bottom, #090a0f, #1b2838, #2c5364); 
    font-family: 'Nunito', sans-serif; user-select: none; color: #333;
}
/* Hiệu ứng Aurora */
.aurora-bg::before, .aurora-bg::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; mix-blend-mode: screen; opacity: 0.6; }
.aurora-bg::before { background: radial-gradient(circle at 50% 100%, rgba(0, 255, 128, 0.2), transparent 50%), radial-gradient(circle at 80% 30%, rgba(0, 128, 255, 0.3), transparent 40%); filter: blur(100px); animation: auroraMove1 20s ease-in-out infinite alternate; }
.aurora-bg::after { background: radial-gradient(circle at 20% 80%, rgba(128, 0, 255, 0.3), transparent 40%), radial-gradient(circle at 70% 50%, rgba(255, 0, 128, 0.2), transparent 50%); filter: blur(120px); animation: auroraMove2 25s ease-in-out infinite alternate-reverse; opacity: 0.5; }
@keyframes auroraMove1 { 0% { transform: translateX(-10%) translateY(-10%) scale(1); } 100% { transform: translateX(10%) translateY(10%) scale(1.1); } }
@keyframes auroraMove2 { 0% { transform: translateX(5%) translateY(5%) scale(1.1); } 100% { transform: translateX(-5%) translateY(-5%) scale(1); } }

.moon { position: absolute; top: 50px; right: 100px; width: 80px; height: 80px; background: #fffce6; border-radius: 50%; box-shadow: 0 0 80px #fffce6, 0 0 30px #ffd700; opacity: 0.95; z-index: 1; }
.star { position: absolute; background: #fff; border-radius: 50%; animation: twinkle infinite alternate; box-shadow: 0 0 5px #fff; }
@keyframes twinkle { 0% { opacity: 0.3; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1.2); } }
.cloud-container { position: absolute; inset: 0; pointer-events: none; z-index: 2; opacity: 0.3; }
.cloud { position: absolute; background-image: url('https://cdn-icons-png.flaticon.com/512/414/414927.png'); background-size: contain; background-repeat: no-repeat; filter: brightness(1.2); }
.c1 { top: 15%; left: -150px; width: 200px; height: 120px; animation: floatCloud 45s linear infinite; }
.c2 { top: 25%; right: -180px; width: 160px; height: 100px; animation: floatCloudReverse 50s linear infinite; }
.c3 { top: 5%; right: 20%; width: 120px; height: 80px; animation: floatCloudReverse 60s linear infinite; }
@keyframes floatCloud { from { transform: translateX(-300px); } to { transform: translateX(120vw); } }
@keyframes floatCloudReverse { from { transform: translateX(300px); } to { transform: translateX(-120vw); } }

/* TUYẾT RƠI (GPU Optimized) */
.snow-container { position: absolute; height: 100%; width: 100%; top: 0; left: 0; pointer-events: none; z-index: 3; overflow: hidden; }
.snow { position: absolute; top: 0; left: 0; width: 100%; height: 100%; animation: snowAnim linear infinite; background-repeat: repeat; will-change: transform; }
.snow-1 { background-image: radial-gradient(2px 2px at 20% 30%, #fff, transparent), radial-gradient(2px 2px at 40% 70%, #fff, transparent); background-size: 200px 200px; animation-duration: 35s; opacity: 0.4; filter: blur(1px); }
.snow-2 { background-image: radial-gradient(3px 3px at 15% 15%, #fff, transparent), radial-gradient(3px 3px at 75% 35%, #fff, transparent); background-size: 300px 300px; animation-duration: 25s; opacity: 0.6; }
.snow-3 { background-image: radial-gradient(4px 4px at 50% 50%, #fff, transparent), radial-gradient(4px 4px at 90% 10%, #fff, transparent); background-size: 400px 400px; animation-duration: 15s; opacity: 0.9; }
.snow-4 { background-image: radial-gradient(8px 8px at 10% 80%, rgba(255,255,255,0.8), transparent), radial-gradient(6px 6px at 80% 10%, rgba(255,255,255,0.8), transparent); background-size: 600px 600px; animation-duration: 8s; opacity: 1; filter: blur(2px); z-index: 4; }
@keyframes snowAnim { 0% { transform: translateY(0); } 100% { transform: translateY(100vh); } }

/* CÂY THÔNG & SANTA */
.main-scene { position: absolute; bottom: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
.tree-area { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: auto; height: auto; pointer-events: auto; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; }
.tree-wrapper { position: relative; transition: transform 0.1s; transform-origin: bottom center; }
.tree-wrapper.swaying { animation: gentleSway 4s ease-in-out infinite alternate; }
.tree-wrapper.shaking { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both !important; }
@keyframes gentleSway { 0% { transform: rotate(-2deg); } 100% { transform: rotate(2deg); } }
.tree-img { width: auto; height: auto; max-width: 650px; max-height: 80vh; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.7)); }
@keyframes shake { 10%, 90% { transform: translate3d(-5px, 0, 0); } 20%, 80% { transform: translate3d(8px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-12px, 0, 0); } 40%, 60% { transform: translate3d(12px, 0, 0); } }
.tree-snowflake { position: absolute; width: 10px; height: 10px; background: #fff; border-radius: 50%; pointer-events: none; animation: dropSnow 1s ease-in forwards; }
@keyframes dropSnow { to { transform: translateY(250px); opacity: 0; } }
.tap-hint { color: #fff; font-size: 1.2rem; margin-top: 15px; opacity: 0.9; text-shadow: 2px 2px 4px black; font-weight: bold; animation: pulseText 2s infinite; }
@keyframes pulseText { 0%, 100% { opacity: 0.8; } 50% { opacity: 1; transform: scale(1.05); } }

.santa-wrapper { position: absolute; top: 8%; left: -250px; width: 160px; z-index: 4; pointer-events: none; animation: flyAcross 30s linear infinite; }
.santa-img { width: 100%; filter: drop-shadow(0 8px 8px rgba(0,0,0,0.3)); }
@keyframes flyAcross { 0% { left: -250px; transform: scaleX(1); } 48% { left: 110vw; transform: scaleX(1); } 50% { left: 110vw; transform: scaleX(-1); } 98% { left: -250px; transform: scaleX(-1); } 100% { left: -250px; transform: scaleX(1); } }

/* =========================================
   QUÀ RƠI TỐI ƯU (PURE CSS ANIMATION)
   ========================================= */
.falling-layer { position: absolute; inset: 0; z-index: 20; pointer-events: none; overflow: hidden; }

.gift-item {
    position: absolute;
    /* Khởi tạo ở trên cùng màn hình */
    top: -100px; 
    width: 80px; height: 80px; 
    pointer-events: auto; cursor: pointer;
    display: flex; justify-content: center; align-items: center;
    
    /* TỐI ƯU HÓA: Dùng will-change để báo trình duyệt dùng GPU */
    will-change: transform; 
    
    /* Animation rơi vô tận */
    animation: fallGift linear infinite;
}

/* Animation rơi từ trên xuống dưới dùng transform (mượt mà) */
@keyframes fallGift {
    0% { transform: translateY(0) rotate(0deg); }
    100% { transform: translateY(120vh) rotate(360deg); }
}

.gift-emoji { font-size: 4rem; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3)); z-index: 2; transition: transform 0.2s; line-height: 1; }
.gift-glow { position: absolute; width: 120%; height: 120%; background: radial-gradient(circle, rgba(255, 215, 0, 0.4) 0%, transparent 70%); z-index: 1; animation: pulseGlow 1.5s infinite alternate; }
.gift-item:active .gift-emoji { transform: scale(0.8); }
@keyframes pulseGlow { 0% { opacity: 0.5; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1.1); } }

.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100; display: flex; justify-content: center; align-items: center; padding: 20px; perspective: 1000px; }
.close-btn { position: absolute; top: -15px; right: -15px; width: 40px; height: 40px; background: #c62828; color: white; border: 3px solid #fff; border-radius: 50%; font-weight: bold; cursor: pointer; font-size: 1.2rem; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: transform 0.2s; z-index: 20; }
.close-btn:hover { transform: scale(1.1) rotate(90deg); }
.modal-content.image-type { position: relative; background: #fff; padding: 15px; border-radius: 15px; display: inline-block; box-shadow: 0 20px 50px rgba(0,0,0,0.5); animation: popIn 0.3s; }
.modal-img { display: block; max-width: 100%; max-height: 75vh; object-fit: contain; border-radius: 8px; }

/* MODAL THƯ */
.letter-modal-container { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
.envelope-wrap { position: absolute; width: 320px; height: 220px; z-index: 20; transition: all 0.6s ease; }
.envelope-wrap.vanish { opacity: 0; pointer-events: none; transform: scale(1.2); }
.envelope { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; }
.envelope-back { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: #b71c1c; border-radius: 8px; box-shadow: 0 15px 35px rgba(0,0,0,0.6); z-index: 1; border: 2px solid #880e4f; }
.envelope-front { position: absolute; bottom: 0; left: 0; width: 0; height: 0; z-index: 10; border-style: solid; border-width: 0 160px 130px 160px; border-color: transparent transparent #d32f2f transparent; pointer-events: none; filter: drop-shadow(0 -3px 5px rgba(0,0,0,0.1)); }
.envelope-flap { position: absolute; top: 0; left: 0; width: 0; height: 0; z-index: 12; border-style: solid; border-width: 110px 160px 0 160px; border-color: #c62828 transparent transparent transparent; transform-origin: top; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); pointer-events: none; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); }
.envelope-wrap.open .envelope-flap { transform: rotateX(180deg); z-index: 1; }
.seal { position: absolute; top: 110px; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: #fbc02d; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; z-index: 15; box-shadow: 0 4px 8px rgba(0,0,0,0.4); border: 3px solid #f9a825; transition: transform 0.3s, opacity 0.3s; }
.envelope-wrap.open .seal { transform: translate(-50%, -50%) scale(0); opacity: 0; }

.real-letter-card { position: relative; width: 600px; max-width: 90vw; height: auto; max-height: 80vh; z-index: 10; opacity: 0; transform: translateY(50px) scale(0.8); transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); display: flex; flex-direction: column; }
.real-letter-card.visible { opacity: 1; z-index: 50; transform: translateY(0) scale(1); }
.paper-texture { width: 100%; height: 100%; background-color: #fffdf0; background-image: linear-gradient(90deg, transparent 95%, rgba(198, 40, 40, 0.05) 95%), linear-gradient(#e5e5e5 1px, transparent 1px); background-size: 100% 100%, 100% 30px; border-radius: 4px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); padding: 40px 50px; position: relative; display: flex; flex-direction: column; overflow: hidden; }
.stamp { position: absolute; top: 20px; right: 20px; width: 60px; height: 70px; background: #fff; border: 4px dotted #c62828; display: flex; justify-content: center; align-items: center; box-shadow: 2px 2px 5px rgba(0,0,0,0.2); transform: rotate(10deg); z-index: 5; }
.stamp-inner { font-size: 30px; }
.letter-content { width: 100%; height: 100%; display: flex; flex-direction: column; overflow: hidden; }
.letter-title { font-family: 'Dancing Script', cursive; font-weight: 700; color: #b71c1c; font-size: 2.5rem; margin: 0 0 10px 0; text-align: center; flex-shrink: 0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; line-height: 1.3; padding: 0 60px; z-index: 2; }
.letter-divider { width: 50%; height: 2px; background: #c62828; margin: 0 auto 20px auto; opacity: 0.3; flex-shrink: 0; }
.letter-body-scroll { flex-grow: 1; overflow-y: auto; margin-bottom: 20px; padding-right: 10px; scrollbar-width: thin; scrollbar-color: #e57373 transparent; -webkit-overflow-scrolling: touch; pointer-events: auto; }
.letter-body-scroll::-webkit-scrollbar { width: 6px; }
.letter-body-scroll::-webkit-scrollbar-thumb { background: #e57373; border-radius: 4px; }
.letter-text { font-family: 'Dancing Script', cursive; font-weight: 400; font-size: 1.5rem; line-height: 1.8; color: #263238; text-align: justify; white-space: pre-wrap; word-break: break-word; margin: 0; }
.close-letter-btn { position: absolute; bottom: -50px; left: 50%; transform: translateX(-50%); background: #fff; color: #c62828; font-family: 'Nunito', sans-serif; border: 2px solid #c62828; padding: 10px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-transform: uppercase; letter-spacing: 1px; transition: all 0.2s; }
.close-letter-btn:hover { background: #c62828; color: #fff; }

/* --- RESPONSIVE MOBILE --- */
@media (max-width: 768px) {
    .tree-img { max-width: 90vw; max-height: 60vh; }
    .tree-area { bottom: 70px; }
    .santa-wrapper { width: 120px; top: 10%; }
    
    .gift-item { width: 50px; height: 50px; }
    .gift-emoji { font-size: 2.5rem; }

    .envelope-wrap { width: 300px; height: 200px; }
    .envelope-front { border-width: 0 150px 120px 150px; }
    .envelope-flap { border-width: 100px 150px 0 150px; }
    .real-letter-card { width: 95vw; min-height: 60vh; max-height: 75vh; }
    .paper-texture { padding: 20px 25px; background-size: 100% 100%, 100% 25px; }
    .letter-title { font-size: 1.8rem; padding: 0 35px; }
    .letter-text { font-size: 1.3rem; line-height: 1.6; }
    .stamp { width: 40px; height: 50px; top: 10px; right: 10px; }
    .stamp-inner { font-size: 20px; }
    .close-letter-btn { bottom: -60px; }
}